name: "feature"
version: "1.0.0"
description: "Feature development workflow with enhanced validation and testing"

variables:
  max_retries: 3
  timeout_minutes: 45
  feature_timeout: 2400
  comprehensive_qa_timeout: 1800

steps:
  - id: "requirements"
    name: "Feature Requirements Analysis"
    type: "persona-request"
    persona: "implementation-planner"
    timeout: 1200
    retries: 2
    params:
      stage: "requirements"
      analysis_depth: "comprehensive"
      
  - id: "design"
    name: "Feature Design Review"
    type: "persona-request"
    persona: "plan-evaluator"
    dependencies: ["requirements"]
    timeout: 900
    params:
      stage: "design"
      review_scope: "architecture"
      
  - id: "implementation"
    name: "Feature Implementation"
    type: "persona-request"
    persona: "lead-engineer"
    dependencies: ["design"]
    timeout: "{{variables.feature_timeout}}"
    retries: 2
    params:
      stage: "feature_implementation"
      apply_changes: true
      test_coverage: "comprehensive"
      
  - id: "comprehensive-qa"
    name: "Comprehensive QA Testing"
    type: "persona-request"
    persona: "qa-engineer"
    dependencies: ["implementation"]
    timeout: "{{variables.comprehensive_qa_timeout}}"
    params:
      stage: "comprehensive_qa"
      test_types: ["unit", "integration", "e2e"]
      performance_testing: true
      
  - id: "governance-reviews"
    name: "Feature Governance"
    type: "parallel"
    dependencies: ["comprehensive-qa"]
    condition: "context.state.get('qa_status') === 'pass'"
    wait_for: "all"
    steps:
      - id: "code-review"
        name: "Code Quality Review"
        type: "persona-request"
        persona: "code-reviewer"
        timeout: 1500
        params:
          stage: "code_review"
          depth: "thorough"
          
      - id: "security-review"
        name: "Security Assessment"
        type: "persona-request"
        persona: "security-review"
        timeout: 1500
        params:
          stage: "security_assessment"
          scope: "comprehensive"
          
      - id: "performance-review"
        name: "Performance Review"
        type: "persona-request"
        persona: "performance-reviewer"
        timeout: 1200
        condition: "task.scope === 'large' || task.performance_critical === true"
        params:
          stage: "performance"
          benchmarking: true
          
  - id: "documentation"
    name: "Feature Documentation"
    type: "persona-request"
    persona: "documentation-writer"
    dependencies: ["governance-reviews"]
    timeout: 900
    params:
      stage: "documentation"
      types: ["api", "user", "technical"]
      
  - id: "finalization"
    name: "Feature Finalization"
    type: "git-operation"
    dependencies: ["documentation"]
    operation: "feature_complete"
    params:
      merge_strategy: "merge_commit"
      tag_release: true
      update_changelog: true