name: "project-loop"
version: "1.0.0"
description: "Standard project development workflow with planning, implementation, QA, and governance"

# Note: This workflow processes ONE task at a time. The WorkflowCoordinator loops through
# all pending dashboard tasks, running this workflow for each until all tasks are done
# or a critical error aborts the project loop.

variables:
  # Timeout values for individual persona steps (in seconds)
  # Each step can have its own timeout and retry configuration
  planning_timeout: 1800      # 30 minutes for planning
  implementation_timeout: 3600 # 60 minutes for implementation
  qa_timeout: 1200            # 20 minutes for QA

steps:
  - id: "planning"
    name: "Implementation Planning"
    type: "persona-request"
    persona: "implementation-planner"
    timeout: "{{variables.planning_timeout}}"
    retries: 2
    params:
      stage: "initial"
      context: "task"
      
  - id: "plan-evaluation"
    name: "Plan Evaluation"
    type: "persona-request"
    persona: "plan-evaluator"
    dependencies: ["planning"]
    timeout: 900
    condition: "context.state.get('planning_result')"
    params:
      stage: "evaluation"
      
  - id: "implementation"
    name: "Lead Engineer Implementation"
    type: "persona-request"
    persona: "lead-engineer"
    dependencies: ["plan-evaluation"]
    timeout: "{{variables.implementation_timeout}}"
    retries: 1
    params:
      stage: "implementation"
      apply_changes: true
      
  - id: "qa"
    name: "Quality Assurance"
    type: "persona-request"
    persona: "qa-engineer"
    dependencies: ["implementation"]
    timeout: "{{variables.qa_timeout}}"
    params:
      stage: "qa"
      test_execution: true
      
  - id: "governance"
    name: "Governance Reviews"
    type: "parallel"
    dependencies: ["qa"]
    condition: "context.state.get('qa_status') === 'pass'"
    steps:
      - id: "code-review"
        name: "Code Review"
        type: "persona-request"
        persona: "code-reviewer"
        timeout: 1200
        params:
          stage: "review"
          
      - id: "security-review"
        name: "Security Review"
        type: "persona-request"
        persona: "security-review"
        timeout: 1200
        params:
          stage: "security"
          
  - id: "completion"
    name: "Task Completion"
    type: "git-operation"
    dependencies: ["governance"]
    operation: "finalize"
    params:
      merge_strategy: "squash"
      cleanup_branch: true